<!-- View file using: https://htmlpreview.github.io/?https://github.com/q-variance/challenge/blob/main/leaderboard/leaderboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Variance Challenge Leaderboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        h1 { color: #d9534f; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background-color: white; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #d9534f; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .passed { background-color: #d4edda; }
        .failed { background-color: #f8d7da; }
        .loading { text-align: center; color: #6c757d; font-style: italic; }
        .error { color: #dc3545; text-align: center; }
    </style>
</head>
<body>
    <h1>Q-Variance Challenge Leaderboard</h1>
    <p style="text-align: center; font-size: 14px;">Target: Global R² ≥ 0.99 using ≤2 free parameters (continuous-time models only)</p>
    
    <table id="leaderboard">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Submission</th>
                <th>Author</th>
                <th>R²</th>
                <th>Params</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <tr><td colspan="7" class="loading">Loading submissions...</td></tr>
        </tbody>
    </table>

    <script>
        async function loadSubmissions() {
            const body = document.getElementById('table-body');
            body.innerHTML = '<tr><td colspan="7" class="loading">Fetching from GitHub API...</td></tr>';
            
            try {
                // Fetch submissions folder contents via GitHub API
                const response = await fetch('https://api.github.com/repos/q-variance/challenge/contents/submissions?ref=main');
                const dirs = await response.json();
                const submissions = [];
                
                // Loop through each submission folder
                for (const dir of dirs) {
                    if (dir.type !== 'dir') continue;
                    const subName = dir.name;
                    
                    // Fetch README.md for metadata
                    const readmeResponse = await fetch(`https://api.github.com/repos/q-variance/challenge/contents/submissions/${subName}/README.md?ref=main`);
                    const readme = await readmeResponse.json();
                    const readmeContent = atob(readme.content);  // Decode base64
                    
                    // Parse README for R², params, etc. (simple regex for demo)
                    const r2Match = readmeContent.match(/R²[:\s]*([\d.]+)/i);
                    const paramsMatch = readmeContent.match(/Params[:\s]*([\d.]+)/i);
                    const r2 = r2Match ? parseFloat(r2Match[1]) : 0;
                    const params = paramsMatch ? parseInt(paramsMatch[1]) : 'N/A';
                    
                    submissions.push({
                        name: subName,
                        r2: r2,
                        params: params,
                        date: new Date().toISOString().split('T')[0]  // Demo date
                    });
                }
                
                // Sort by R² descending
                submissions.sort((a, b) => b.r2 - a.r2);
                
                if (submissions.length === 0) {
                    body.innerHTML = '<tr><td colspan="7" class="error">No submissions yet. Be the first!</td></tr>';
                    return;
                }
                
                // Render table
                body.innerHTML = '';
                submissions.forEach((sub, index) => {
                    const status = sub.r2 >= 0.92 ? 'Passed' : 'Failed';
                    const rowClass = status === 'Passed' ? 'passed' : 'failed';
                    body.innerHTML += `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td>${sub.name}</td>
                            <td>Grok (xAI)</td>
                            <td>${sub.r2.toFixed(4)}</td>
                            <td>${sub.params}</td>
                            <td>${status}</td>
                            <td>${sub.date}</td>
                        </tr>
                    `;
                });
            } catch (error) {
                body.innerHTML = '<tr><td colspan="7" class="error">Error loading submissions. Check console.</td></tr>';
                console.error('Leaderboard load error:', error);
            }
        }
        
        // Load on page load
        window.onload = loadSubmissions;
    </script>
</body>
</html>
